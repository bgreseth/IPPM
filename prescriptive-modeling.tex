\chapter{Prescriptive Modeling}
\section{Linear Programming}

% this section needs to be re-written
\emph{A Resource Allocation Problem.} This example is taken 
from~\cite{chvatal:1983}.  A forester has 100
acres of hardwood timber. She also has \$4000 cash on-hand to use for
the forestry business. There are two possible courses of action to 
take with the 100 acres of available hardwood:
\begin{enumerate}
\item Harvest the hardwood and let the area naturally regenerate. This
  would cost \$10 per acre now and return \$50 per acre later,
  yielding a profit of \$40 per acre.
\item Harvest the hardwood and plant the area with pine. This would
  cost \$50 per acre now and return \$120 per acre later, yielding a
  profit of \$70 per acre. \label{d2}
\end{enumerate}
Option \ref{d2} is clearly more profitable; however, the forester must
respect her budget of \$4000. The mathematical programming problem is
to maximize total profit subject to the resource constraints, which
are the acres of available hardwood and the budget.

The complete problem formulation in AMPL is shown in
figure~\ref{forest}.  Two decision variables, \texttt{x1} and
\texttt{x2}, represent the number of acres that the forester should
allocate to each of the two possible courses of action.  It would make
no sense to allow these decision variables to take on negative
values. The non-negativity requirements are more cleanly specified
directly in the variable declarations as opposed to creating separate
constraints. A graphical depiction of the feasible solution space is
shown in figure~\ref{feasibleregion}.

\begin{SaveVerbatim}{vrbforest}
var x1 >= 0;  # acres to fell and let regenerate
var x2 >= 0;  # acres to fell and plant with pine

maximize profit: 40*x1 + 70*x2;

s.t. acres: x1 + x2 <= 100;
s.t. budget: 10*x1 + 50*x2 <= 4000;
\end{SaveVerbatim}

\begin{figure}
\fbox{
\begin{minipage}{\textwidth}
\BUseVerbatim{vrbforest}
\caption{Forestry problem (\texttt{forester.mod})}
\label{forest}
\end{minipage}
}
\end{figure}

\begin{figure}
\begin{center}
\begin{tikzpicture}
  \begin{axis}[ width=12cm,
    unit vector ratio*=1 1 1,
    enlargelimits=false,
    grid=both,
    axis x line=middle,
    axis y line=middle,
    title=,
    clip=false,
    ymin=0, ymax=120,
    xmin=0, xmax=420 ]

    \addplot[domain=-10:410] {80 - .2*x};
    \addplot[domain=-5:102] {100 - x};
    \addplot[domain=-5:45,dashed] {20 - .57143*x};
    \addplot[fill=gray, fill opacity=.25]
    coordinates { (0,0) (100,0) (25,75) (0,80) }\closedcycle;

  % to get axis labels at the end of the axis
  \node at (axis description cs:1.04,0) {$x_1$}; \node at
  (axis description cs:0,1.04) {$x_2$};
\end{axis}
\end{tikzpicture}
\end{center}
\caption{Feasible Region for the Forestry Problem}
\label{feasibleregion}
\end{figure}

The constraints labeled \texttt{acres} and \texttt{budget} represent
the limitations on available resources.  It's unnecessary to
explicitly name constraints in AMPL; however, providing short,
descriptive names aids interpretation of the model. Moreover, in a
resource allocation problem such as this, the constraint names refer
to the values of the associated dual variables, which have an economic
interpretation as the marginal value of an additional unit of the
resource.

This problem is small enough that we can include all data parameters
directly in the model specification. Although we will not cover it in
this quick start guide, it is good practice to separate the data from
the model, and AMPL encourages this separation by providing
\texttt{param} declarations and the ability to have a separate
\texttt{data} section. Indeed, it's hard to understand the benefit of
an algebraic modeling language unless you are working on a large
problem.  It's worth noting that AMPL doesn't actually solve the
mathematical programming problem, but rather passes a description of
the problem to a solver, which returns information about the solution
(if any solution was found) to AMPL. An AMPL session for the forestry
problem follows:

\begin{Verbatim}[samepage=true]
ampl: model forester.mod;
ampl: solve;
MINOS 5.5: optimal solution found.
2 iterations, objective 6250
ampl: display x1,x2;
x1 = 25
x2 = 75
\end{Verbatim}

The optimal solution indicates that the forester should let 25 acres
of the hardwood regenerate naturally and plant 75 acres with pine, for
a total profit of \$6250. Notice that the entire budget of \$4000 is
exhausted because $10 \times 25 + 50 \times 75 = 4000$. When a
resource capacity constraint such as \texttt{acres} or \texttt{budget}
holds with equality in the optimal solution (as in this example), then
the constraint is \emph{binding}; all of the resource associated with
the constraint is being consumed. If more/less of the resource were
available, then profit would be increased/decreased. The value of the
associated dual variable indicates the amount by which profit would be
affected for small changes in the supply of the resource. This is
called the marginal value of a resource, or the shadow price.

\begin{Verbatim}[samepage=true]
ampl: display acres, budget;
acres = 32.5
budget = 0.75
\end{Verbatim}

In AMPL the name of a constraint is used to refer to the associated
dual variable. Displaying the shadow prices for the forester problem
indicates that an additional acre of hardwood timber would increase
profit by \$32.50, given the same budget of \$4000.  Modifying the
right-hand side of \texttt{acres} to 101 and re-solving shows that
this is indeed the case.

\begin{Verbatim}[samepage=true]
ampl: reset;
ampl: model forester.mod;
ampl: expand acres;
subject to acres:
	x1 + x2 <= 101;

ampl: solve;
MINOS 5.5: optimal solution found.
2 iterations, objective 6282.5
ampl: display x1,x2;
x1 = 26.25
x2 = 74.75
\end{Verbatim}

The \texttt{expand} command displays the full form of a set of
constraints.  (This will be useful for indexed expressions.) Notice
that the values of the decision variables have necessarily changed and
that the solution is no longer integer-valued.  This is typical of
resource allocation problems. We are in fact assuming that the
forester is able to execute the decisions on partial acres.  For the
\texttt{budget} constraint, an additional one dollar increase/decrease
in the right-hand side would increase/decrease profit by \$0.75, given
the same 100 acres of hardwood. It stands to reason, then, that the
forester could take out a loan and apply the funds to her
operation. As long as the interest rate is less than .75, profit will
increase.

Shadow prices are valid for \emph{limited} increases/decreases in the
right-hand sides of the constraints. The ranges over which the these
values are valid is a topic of sensitivity analysis. Here, we will
show how to extract this information from AMPL. First we need to tell
AMPL to use a solver that is able to return sensitivity information
along with the optimal solution. We will instruct AMPL to use the solver
\texttt{gurobi}. Then we set a solver-specific option to make the
sensitivity range information available.

\begin{Verbatim}[samepage=true]
ampl: reset;
ampl: model forester.mod;
ampl: option solver gurobi;
ampl: option gurobi_options 'solnsens 1'; 
ampl: solve;
Gurobi 8.1.0: solnsens 1
Gurobi 8.1.0: optimal solution; objective 6250

suffix sensublo OUT;
suffix sensubhi OUT;
suffix sensobjlo OUT;
suffix sensobjhi OUT;
suffix senslblo OUT;
suffix senslbhi OUT;
suffix sensrhslo OUT;
suffix sensrhshi OUT;
\end{Verbatim}

We are now able to display the ranges over which the current shadow
prices of \$32.5 per acre and \$0.75 per dollar of budget are
valid. To do this we simply add a suffix to the name of the
constraint, separated by a ``\texttt{.}''. The suffix
\texttt{.sensrhslo} displays the lower limit of a constraint's
right-hand side, while \texttt{.sensrhshi} displays the upper limit.
In the AMPL session follows, the
upper limit of 5000 on the right-hand side of \texttt{budget}
indicates the forester should only consider loans of \$1000 or less to
be valued at an incremental marginal value of 0.75.

\begin{Verbatim}[samepage=true]
ampl: display acres.sensrhslo, acres.sensrhshi;
acres.sensrhslo = 80
acres.sensrhshi = 400

ampl: display budget.sensrhslo, budget.sensrhshi;
budget.sensrhslo = 1000
budget.sensrhshi = 5000
\end{Verbatim}

Sensitivity ranges may also be obtained for the decision variables. In
this case the lower and upper limits represent the valid ranges on the
objective function coefficients over which the current solution
remains optimal.  The suffixes \texttt{.sensobjlo} and
\texttt{.sensobjhi} are used to refer to these lower and upper limits.
Displaying this information for the forestry problem reveals that the
current solution value of \texttt{x1 = 25} remains optimal as long as
its coefficient in the objective function is in the range 14 to 70,
holding all other parameters at their current values.

\begin{Verbatim}[samepage=true]
ampl: display x1.sensobjlo, x1.sensobjhi;
x1.sensobjlo = 14
x1.sensobjhi = 70

ampl: display x2.sensobjlo, x2.sensobjhi;
x2.sensobjlo = 40
x2.sensobjhi = 200
\end{Verbatim}

The other suffixes, \texttt{.senslblo}, \texttt{.senslbhi},
\texttt{.sensublo}, and \texttt{.sensubhi}, refer to ranges on the
values (not the coefficients) of the decision variables over which the
current basis remains optimal. We will not use these suffixes.

\section{Integer Programming}

\section{Dynamic Programming}

\section{Inventory Models}

\section{Exercises}
\begin{enumerate}

% written by Hannah
\item \emph{Feasible region for an LP.} Indicate graphically whether each of the following
  linear programs has a feasible solution. Graphically determine the
  optimal solution, if one exists, or show that no optimal solution
  exists.

\begin{enumerate}
\item
\[
  \begin{array}{lrrrrr}
    \textrm{maximize}   & x_1& +& 3x_2&  & \\
    \textrm{subject to} & x_1& -&4x_2& \leq & 4  \\
                        & x_1& +& 2x_2& \leq & 4 \\
    \multicolumn{3}{r}{x_1,x_2}&       \geq & 0 
  \end{array}
\]

\item
\[
  \begin{array}{lrrrrr}
    \textrm{minimize}   & x_1& +& 2x_2&  & \\
    \textrm{subject to} & 2x_1& -&x_2& \leq & 3  \\
                        & 2x_1& -& x_2& \geq & -3 \\
    \multicolumn{3}{r}{x_1,x_2}&       \geq & 0 
  \end{array}
\]

\end{enumerate}

\begin{solution}
\bs The feasible region for the linear program in part a) is shown
below. The objective function is plotted as a dashed line. The
optimal solution occurs at $x_1=0$, $x_2=2$, and value of the
objective function at the optimal solution is $z=6$.

\begin{center}
\begin{tikzpicture}
  \begin{axis}[ width=12cm, grid=both, axis x line=middle, axis y
    line=middle, title=, clip=false, ymin=-2, ymax=4, xmin=-2,
    xmax=6 ]

    \addplot[domain=-2:6] {-1 + 1/4*x}; \addplot[domain=-2:6] {2
      - 1/2*x}; \addplot[domain=-2:6,dashed] {2 - 1/3*x};
    \addplot[fill=gray, fill opacity=.25] coordinates { (0,0)
      (4,0) (0,2) }\closedcycle;

    % to get axis labels at the end of the axis
    \node at (axis description cs:1.04,.333) {$x_1$}; \node at
    (axis description cs:.333,1.04) {$x_2$};
  \end{axis}
\end{tikzpicture}
\end{center}

The feasible region for the linear program in part b) is unbounded;
however, since it is a minimization problem, it has an optimal
solution at $x_1=0$, $x_2=0$. The value of the objective function at
the optimal solution is $z=0$.

\begin{center}
\begin{tikzpicture}
  \begin{axis}[ width=12cm, grid=both, axis x line=middle, axis y
    line=middle, title=, clip=false, ymin=-3, ymax=4, xmin=-3,
    xmax=3 ]

    \addplot[domain=0:3] {-3 +2*x}; \addplot[domain=-3:.5] {3+2*x};
    \addplot[domain=-3:3,dashed] {-1/2*x}; \addplot[fill=gray, fill
    opacity=.25] coordinates { (0,0) (0,3) (.5,4) (3,4) (3,3) (1.5,0)
    }\closedcycle;

    % to get axis labels at the end of the axis
    \node at (axis description cs:1.04,.5) {$x_1$}; \node at (axis
    description cs:.5,1.04) {$x_2$};
  \end{axis}
\end{tikzpicture}
\end{center}

\end{solution}

% this exercise needs to be re-written
\item \emph{Resource allocation to maximize profit.} 
At the Ma-and-Pa grocery store, shelf space is limited
  and must be used effectively to increase profit. Two cereal items,
  Grano and Wheatie, compete for a total shelf space of 60 ft$^2$. A
  box of Grano occupies .2 ft$^2$ and a box of Wheatie requires .4
  ft$^2$. The maximum daily demands for Grano and Wheatie are 200 and 120
  boxes, respectively. A box of Grano nets \$1.00 in profit, while a
  box of Wheatie nets \$1.35. Ma and Pa think that because the unit
  profit of Wheatie is 35\% higher than that of Grano, Wheatie should
  be allocated 35\% more space than Grano, which amounts to allocating
  about 57\% to Wheatie and 43\% to Grano. What do you think?
  (You can solve this problem however you like, but you must provide
  the allocation of shelf space that maximizes profit.)
  

\begin{solution}
\bs My AMPL model and output follow. The solution indicates that more
space should be allocated to Grano than Wheatie. This is because
the profit per square foot is larger. The solution indicates that
Ma and Pa should stock 200 boxes of Grano and 50 boxes of Wheatie.

\begin{Verbatim}[samepage=true]
var x1 >=0, <= 200;   # boxes of grano
var x2 >= 0, <= 120;  # boxes of wheatie

maximize profit: x1 + 1.35*x2;
s.t. space: .2*x1 + .4*x2 <= 60;

ampl: model '/home/darin/Dropbox/isye/ie1101/hw/ma-and-pa-store.mod';
ampl: solve;
MINOS 5.51: optimal solution found.
2 iterations, objective 267.5
ampl: display x1, x2;
x1 = 200
x2 = 50
\end{Verbatim}
\end{solution}

% this problem needs to be re-written and GAMS code needs to be added.
\item \emph{A network flow problem.}
The U.S. government is auctioning oil leases at two sites, A and B. At
each site, 100,000 acres are to be auctioned. Three people are bidding
as follows.

\begin{tabular}{crr}
Bidder & site A & site B \\ \hline
Marshall & \$1000/acre & \$2000/acre \\
Ewing     & \$900/acre & \$2200/acre \\
Pickens  & \$1100/acre & \$1900/acre
\end{tabular}

The rules are that no bidder can receive more than 40\% of the land
being auctioned (i.e. the total amount of land being auctioned at
\emph{both} sites).
\begin{compactenum}
  \item Draw a diagram of the problem as a network flow model.
  \item Formulate a linear programming model to maximize the
    government's revenue.
  \item Solve the problem using optimization software.
\end{compactenum}

\begin{solution}
  \bs A diagram of the network flow model is shown below. Bidders 1, 2,
  and 3 correspond to Marshall, Ewing, and Pickens, respectively.
\vspace{.2in}
\begin{center}
\begin{tikzpicture}[>=latex] % to get latex arrowheads

  \node[circle,draw](B) at (0,2) {B};
  \node[circle,draw](A) at (0,4) {A};
  \node[circle,draw](3) at (4,1) {3};
  \node[circle,draw](2) at (4,3) {2};
  \node[circle,draw](1) at (4,5) {1};

  \draw[->] (A) -- (1) node[above,pos=.3]{1000};
  \draw[->] (A) -- (2) node[above,pos=.3]{900};
  \draw[->] (A) -- (3) node[below,pos=.1]{1100};
  \draw[->] (B) -- (1) node[below,pos=.8]{2000};
  \draw[->] (B) -- (2) node[below,pos=.8]{2200};
  \draw[->] (B) -- (3) node[below,pos=.5]{1900};

  \node[anchor=east] at (A) {100,000~~~~};
  \node[anchor=east] at (B) {100,000~~~~};

\end{tikzpicture}
\end{center}

Let $x_{ij}$ be the amount of land bidder $j$ receives for site $i$.
  \[
     i \in \{\text{A},\text{B}\} \qquad j \in \{1,2,3\}
  \]
  The problem formulation is
\[
  \begin{array}{lrrrrrrrrrr}
    \textrm{maximize} &&&&&&&&&&\\   
    1000x_{\text{A}1}&+& 900x_{\text{A}2}&+&1100x_{\text{A}3}&+&2000x_{\text{B}1}&+&2200x_{\text{B}2}&+&1900x_{\text{B}3} \\ \\
    \textrm{subject to}  &&&&&&&&&&\\
    & & & & x_{\text{A}1}&+ & x_{\text{A}2}&+ &x_{\text{A}3} & = & 100,000 \\
    & & & & x_{\text{B}1}&+ & x_{\text{B}2}&+ &x_{\text{B}3} & = & 100,000 \\
    & & & & & &  x_{\text{A}1} & + & x_{\text{B}1} & \leq & 80,000 \\
    & & & & & &  x_{\text{A}2} & + & x_{\text{B}2} & \leq & 80,000 \\
    & & & & & &  x_{\text{A}3} & + & x_{\text{B}3} & \leq & 80,000 \\
    \multicolumn{11}{r}{x_{ij} \geq 0 \quad \text{for}~i \in \{\text{A},\text{B}\},~j \in \{1,2,3\} }
  \end{array}
\]

The optimal solution
is: bidder 1 (Marshall) receives 20,000 acres at site A and 20,000
acres at site B, bidder 2 (Ewing) receives 80,000 acres at site B, and
bidder 3 (Pickens) receives 80,000 acres at site A. The government
receives \$324 million in revenue.
\end{solution}


\end{enumerate}
